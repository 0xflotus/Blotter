Object.keys||(Object.keys=function(){"use strict";var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=r.length;return function(i){if("object"!=typeof i&&("function"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var o,s,a=[];for(o in i)t.call(i,o)&&a.push(o);if(e)for(s=0;n>s;s++)t.call(i,r[s])&&a.push(r[s]);return a}}()),GrowingPacker=function(){},GrowingPacker.prototype={fit:function(t){var e,r,n,i=t.length,o=i>0?t[0].w:0,s=i>0?t[0].h:0;for(this.root={x:0,y:0,w:o,h:s},e=0;i>e;e++)n=t[e],(r=this.findNode(this.root,n.w,n.h))?n.fit=this.splitNode(r,n.w,n.h):n.fit=this.growNode(n.w,n.h)},findNode:function(t,e,r){return t.used?this.findNode(t.right,e,r)||this.findNode(t.down,e,r):e<=t.w&&r<=t.h?t:null},splitNode:function(t,e,r){return t.used=!0,t.down={x:t.x,y:t.y+r,w:t.w,h:t.h-r},t.right={x:t.x+e,y:t.y,w:t.w-e,h:r},t},growNode:function(t,e){var r=t<=this.root.w,n=e<=this.root.h,i=n&&this.root.h>=this.root.w+t,o=r&&this.root.w>=this.root.h+e;return i?this.growRight(t,e):o?this.growDown(t,e):n?this.growRight(t,e):r?this.growDown(t,e):null},growRight:function(t,e){this.root={used:!0,x:0,y:0,w:this.root.w+t,h:this.root.h,down:this.root,right:{x:this.root.w,y:0,w:t,h:this.root.h}};var r=this.findNode(this.root,t,e);return r?this.splitNode(r,t,e):null},growDown:function(t,e){this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+e,down:{x:0,y:this.root.h,w:this.root.w,h:e},right:this.root};var r=this.findNode(this.root,t,e);return r?this.splitNode(r,t,e):null}};var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var t=document.createElement("div");return t.id="webgl-error-message",t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.background="#fff",t.style.color="#000",t.style.padding="1.5em",t.style.width="400px",t.style.margin="5em auto 0",this.webgl||(t.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),t},addGetWebGLMessage:function(t){var e,r,n;t=t||{},e=void 0!==t.parent?t.parent:document.body,r=void 0!==t.id?t.id:"oldie",n=Detector.getWebGLErrorMessage(),n.id=r,e.appendChild(n)}};"object"==typeof module&&(module.exports=Detector),function(){"use strict";function t(){}function e(t,e){for(var r=t.length;r--;)if(t[r].listener===e)return r;return-1}function r(t){return function(){return this[t].apply(this,arguments)}}var n=t.prototype,i=this,o=i.EventEmitter;n.getListeners=function(t){var e,r,n=this._getEvents();if(t instanceof RegExp){e={};for(r in n)n.hasOwnProperty(r)&&t.test(r)&&(e[r]=n[r])}else e=n[t]||(n[t]=[]);return e},n.flattenListeners=function(t){var e,r=[];for(e=0;e<t.length;e+=1)r.push(t[e].listener);return r},n.getListenersAsObject=function(t){var e,r=this.getListeners(t);return r instanceof Array&&(e={},e[t]=r),e||r},n.addListener=function(t,r){var n,i=this.getListenersAsObject(t),o="object"==typeof r;for(n in i)i.hasOwnProperty(n)&&-1===e(i[n],r)&&i[n].push(o?r:{listener:r,once:!1});return this},n.on=r("addListener"),n.addOnceListener=function(t,e){return this.addListener(t,{listener:e,once:!0})},n.once=r("addOnceListener"),n.defineEvent=function(t){return this.getListeners(t),this},n.defineEvents=function(t){for(var e=0;e<t.length;e+=1)this.defineEvent(t[e]);return this},n.removeListener=function(t,r){var n,i,o=this.getListenersAsObject(t);for(i in o)o.hasOwnProperty(i)&&(n=e(o[i],r),-1!==n&&o[i].splice(n,1));return this},n.off=r("removeListener"),n.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},n.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},n.manipulateListeners=function(t,e,r){var n,i,o=t?this.removeListener:this.addListener,s=t?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(n=r.length;n--;)o.call(this,e,r[n]);else for(n in e)e.hasOwnProperty(n)&&(i=e[n])&&("function"==typeof i?o.call(this,n,i):s.call(this,n,i));return this},n.removeEvent=function(t){var e,r=typeof t,n=this._getEvents();if("string"===r)delete n[t];else if(t instanceof RegExp)for(e in n)n.hasOwnProperty(e)&&t.test(e)&&delete n[e];else delete this._events;return this},n.removeAllListeners=r("removeEvent"),n.emitEvent=function(t,e){var r,n,i,o,s,a=this.getListenersAsObject(t);for(o in a)if(a.hasOwnProperty(o))for(r=a[o].slice(0),i=r.length;i--;)n=r[i],n.once===!0&&this.removeListener(t,n.listener),s=n.listener.apply(this,e||[]),s===this._getOnceReturnValue()&&this.removeListener(t,n.listener);return this},n.trigger=r("emitEvent"),n.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},n.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},n._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},n._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return i.EventEmitter=o,t},"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:i.EventEmitter=t}.call(this),require=function t(e,r,n){function i(s,a){if(!r[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var h=r[s]={exports:{}};e[s][0].call(h.exports,function(t){var r=e[s][1][t];return i(r?r:t)},h,h.exports,t,e,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({"./defaults":[function(t,e,r){"use strict";r.__esModule=!0,r["default"]={pool:{size:navigator.hardwareConcurrency||8}},e.exports=r["default"]},{}],1:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}var i=t("./index"),o=n(i);"object"==typeof window&&(window.thread=o["default"]),"function"==typeof define?define([],function(){return o["default"]}):"object"==typeof e&&(e.exports=o["default"])},{"./index":3}],"./worker":[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){var e=p.getConfig().basepath.web;return e?e+"/"+t:t}function a(t){for(var e=[],r=0;"undefined"!=typeof t[r];)e.push(t[r]),r++;return e}function u(t){if(t.stack)console.error(t.stack);else if(t.message&&t.filename&&t.lineno){var e=t.filename.match(/^data:text\/javascript/)&&t.filename.length>50?t.filename.substr(0,50)+"...":t.filename;console.error(t.message+" @"+e+":"+t.lineno)}else console.error(t)}r.__esModule=!0;var f=t("eventemitter3"),h=n(f),l=t("./slave-code-uri"),c=n(l),p=t("../config");if("object"!=typeof window.Worker&&"function"!=typeof window.Worker)throw new Error("Browser does not support web workers!");var d=function(t){function e(){var r=arguments.length<=0||void 0===arguments[0]?null:arguments[0],n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];i(this,e),t.call(this),this.initWorker(),this.worker.addEventListener("message",this.handleMessage.bind(this)),this.worker.addEventListener("error",this.handleError.bind(this)),r&&this.run(r,n)}return o(e,t),e.prototype.initWorker=function(){try{this.worker=new window.Worker(c["default"])}catch(t){var e=p.getConfig().fallback.slaveScriptUrl;if(!e)throw t;this.worker=new window.Worker(c["default"])}},e.prototype.run=function(t){var e=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];return"function"==typeof t?this.runMethod(t,e):this.runScripts(t,e),this},e.prototype.runMethod=function(t,e){var r=t.toString(),n=r.substring(r.indexOf("(")+1,r.indexOf(")")).split(","),i=r.substring(r.indexOf("{")+1,r.lastIndexOf("}"));this.worker.postMessage({initByMethod:!0,method:{args:n,body:i},scripts:e.map(s)})},e.prototype.runScripts=function(t,e){if(!t)throw new Error("Must pass a function or a script URL to run().");this.worker.postMessage({initByScripts:!0,scripts:e.concat([t]).map(s)})},e.prototype.send=function(t){var e=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];return this.worker.postMessage({doRun:!0,param:t},e),this},e.prototype.kill=function(){return this.worker.terminate(),this.emit("exit"),this},e.prototype.promise=function(){var t=this;return new Promise(function(e,r){t.once("message",e).once("error",r)})},e.prototype.handleMessage=function(t){if(t.data.error)this.handleError(t.data.error);else if(t.data.progress)this.handleProgress(t.data.progress);else{var e=a(t.data.response);this.emit.apply(this,["message"].concat(e))}},e.prototype.handleProgress=function(t){this.emit("progress",t)},e.prototype.handleError=function(t){this.listeners("error",!0)||u(t),t.preventDefault&&t.preventDefault(),this.emit("error",t)},e}(h["default"]);r["default"]=d,e.exports=r["default"]},{"../config":2,"./slave-code-uri":6,eventemitter3:8}],2:[function(t,e,r){"use strict";function n(t,e){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];Object.keys(e).forEach(function(i){var o=e[i],s=r.concat([i]);if("object"==typeof o){if("undefined"!=typeof t[i]&&"object"!=typeof t[i])throw new Error("Expected config property not to be an object: "+s.join("."));n(t[i],o,s)}else{if("object"==typeof t[i])throw new Error("Expected config property to be an object: "+s.join("."));t[i]=o}})}function i(){return a.get()}function o(){return a.set.apply(a,arguments)}r.__esModule=!0,r.getConfig=i,r.setConfig=o;var s={basepath:{node:"",web:""},fallback:{slaveScriptUrl:""}},a={get:function(){return s},set:function(t){if("object"!=typeof t)throw new Error("Expected config object.");n(s,t)}};r["default"]=a},{}],3:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0],e=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];return new c["default"](t,e)}r.__esModule=!0,r.spawn=i,t("native-promise-only");var o=t("./config"),s=n(o),a=t("./defaults"),u=n(a),f=t("./pool"),h=n(f),l=t("./worker"),c=n(l);r.config=s["default"],r.defaults=u["default"],r.Pool=h["default"],r["default"]={config:s["default"],defaults:u["default"],Pool:h["default"],spawn:i,Worker:c["default"]}},{"./config":2,"./defaults":"./defaults","./pool":5,"./worker":"./worker","native-promise-only":9}],4:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}r.__esModule=!0;var s=t("eventemitter3"),a=n(s),u=function(t){function e(r){i(this,e),t.call(this),this.pool=r,this.thread=null,this.runArgs=[],this.clearSendParameter(),r.emit("newJob",this)}return o(e,t),e.prototype.run=function(){for(var t=arguments.length,e=Array(t),r=0;t>r;r++)e[r]=arguments[r];if(0===e.length)throw new Error("Cannot call .run() without arguments.");return this.runArgs=e,this},e.prototype.send=function(){if(0===this.runArgs.length)throw new Error("Cannot .send() before .run().");for(var t=arguments.length,e=Array(t),r=0;t>r;r++)e[r]=arguments[r];if(this.hasSendParameter()){var n;return(n=this.clone().clearSendParameter()).send.apply(n,e)}return this.sendArgs=e,this.parameterSet=!0,this.emit("readyToRun"),this},e.prototype.executeOn=function(t){var e,r;return(e=(r=t.once("message",this.emit.bind(this,"done")).once("error",this.emit.bind(this,"error"))).run.apply(r,this.runArgs)).send.apply(e,this.sendArgs),this.thread=t,this},e.prototype.promise=function(){if(!this.thread)throw new Error("Cannot return promise, since job is not executed.");return this.thread.promise()},e.prototype.clone=function r(){var r=new e(this.pool);return this.runArgs.length>0&&r.run.apply(r,this.runArgs),this.parameterSet&&r.send.apply(r,this.sendArgs),r},e.prototype.hasSendParameter=function(){return this.parameterSet},e.prototype.clearSendParameter=function(){return this.parameterSet=!1,this.sendArgs=[],this},e}(a["default"]);r["default"]=u,e.exports=r["default"]},{eventemitter3:8}],5:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}r.__esModule=!0;var s=t("eventemitter3"),a=n(s),u=t("./job"),f=n(u),h=t("./defaults"),l=n(h),c=t("./"),p=function(t){function e(r){i(this,e),t.call(this),this.threads=e.spawn(r||l["default"].pool.size),this.idleThreads=this.threads.slice(),this.jobQueue=[],this.lastCreatedJob=null,this.on("newJob",this.handleNewJob.bind(this))}return o(e,t),e.prototype.run=function(){var t;return(t=new f["default"](this)).run.apply(t,arguments)},e.prototype.send=function(){var t;if(!this.lastCreatedJob)throw new Error("Pool.send() called without prior Pool.run(). You need to define what to run first.");return(t=this.lastCreatedJob).send.apply(t,arguments)},e.prototype.killAll=function(){this.threads.forEach(function(t){t.kill()})},e.prototype.queueJob=function(t){this.jobQueue.push(t),this.dequeue()},e.prototype.dequeue=function(){if(0!==this.jobQueue.length&&0!==this.idleThreads.length){var t=this.jobQueue.shift(),e=this.idleThreads.shift();t.on("done",this.handleJobSuccess.bind(this,e,t)).on("error",this.handleJobError.bind(this,e,t)),t.executeOn(e)}},e.prototype.handleNewJob=function(t){this.lastCreatedJob=t,t.on("readyToRun",this.queueJob.bind(this,t))},e.prototype.handleJobSuccess=function(t,e){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;r>i;i++)n[i-2]=arguments[i];this.emit.apply(this,["done",e].concat(n)),this.handleJobDone(t)},e.prototype.handleJobError=function(t,e,r){this.emit("error",e,r),this.handleJobDone(t)},e.prototype.handleJobDone=function(t){var e=this;this.idleThreads.push(t),this.dequeue(),this.idleThreads.length===this.threads.length&&setTimeout(function(){e.emit("finished")},0)},e}(a["default"]);r["default"]=p,p.spawn=function(t){for(var e=[],r=0;t>r;r++)e.push(c.spawn());return e},e.exports=r["default"]},{"./":3,"./defaults":"./defaults","./job":4,eventemitter3:8}],6:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}r.__esModule=!0;var i=t("./slave-code"),o=n(i),s="data:text/javascript;charset=utf-8,"+encodeURI(o["default"]),a=window.createBlobURL||window.createObjectURL;if(!a){var u=window.URL||window.webkitURL;if(!u)throw new Error("No Blob creation implementation found.");a=u.createObjectURL}if("function"==typeof window.BlobBuilder&&"function"==typeof a){var f=new window.BlobBuilder;f.append(o["default"]),s=a(f.getBlob())}else if("function"==typeof window.Blob&&"function"==typeof a){var h=new window.Blob([o["default"]],{type:"text/javascript"});s=a(h)}r["default"]=s,e.exports=r["default"]},{"./slave-code":7}],7:[function(t,e,r){e.exports="/*eslint-env worker*/\n/*global importScripts*/\n/*eslint-disable no-console*/\nself.module = {\n  exports : function() {\n    if (console) { console.error('No thread logic initialized.'); }\n  }\n};\n\nfunction handlerDone() {\n  var args = Array.prototype.slice.call(arguments, 0);\n  this.postMessage({ response : args });\n}\n\nfunction handlerProgress(progress) {\n  this.postMessage({ progress : progress });\n}\n\nfunction handlerDoneTransfer() {\n  var args = Array.prototype.slice.call(arguments);\n  var lastArg = args.pop();\n\n  if (!(lastArg instanceof Array) && this.console) {\n    console.error('Expected 2nd parameter of <doneCallback>.transfer() to be an array. Got:', lastArg);\n  }\n\n  this.postMessage({ response : args }, lastArg);\n}\n\nself.onmessage = function (event) {\n  var scripts = event.data.scripts;\n  if (scripts && scripts.length > 0 && typeof importScripts !== 'function') {\n    throw new Error('importScripts() not supported.');\n  }\n\n  if (event.data.initByScripts) {\n    importScripts.apply(null, scripts);\n  }\n\n  if (event.data.initByMethod) {\n    var method = event.data.method;\n    this.module.exports = Function.apply(null, method.args.concat(method.body));\n\n    if (scripts && scripts.length > 0) {\n      importScripts.apply(null, scripts);\n    }\n  }\n\n  if (event.data.doRun) {\n    var handler = this.module.exports;\n    if (typeof handler !== 'function') {\n      throw new Error('Cannot run thread logic. No handler has been exported.');\n    }\n\n    var preparedHandlerDone = handlerDone.bind(this);\n    preparedHandlerDone.transfer = handlerDoneTransfer.bind(this);\n\n    handler.call(this, event.data.param, preparedHandlerDone, handlerProgress.bind(this));\n  }\n}.bind(self);\n"},{}],8:[function(t,e,r){"use strict";function n(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function i(){}var o="function"!=typeof Object.create?"~":!1;i.prototype._events=void 0,i.prototype.listeners=function(t,e){var r=o?o+t:t,n=this._events&&this._events[r];if(e)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,a=new Array(s);s>i;i++)a[i]=n[i].fn;return a},i.prototype.emit=function(t,e,r,n,i,s){var a=o?o+t:t;if(!this._events||!this._events[a])return!1;var u,f,h=this._events[a],l=arguments.length;if("function"==typeof h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),l){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,r),!0;case 4:return h.fn.call(h.context,e,r,n),!0;case 5:return h.fn.call(h.context,e,r,n,i),!0;case 6:return h.fn.call(h.context,e,r,n,i,s),!0}for(f=1,u=new Array(l-1);l>f;f++)u[f-1]=arguments[f];h.fn.apply(h.context,u)}else{var c,p=h.length;for(f=0;p>f;f++)switch(h[f].once&&this.removeListener(t,h[f].fn,void 0,!0),l){case 1:h[f].fn.call(h[f].context);break;case 2:h[f].fn.call(h[f].context,e);break;case 3:h[f].fn.call(h[f].context,e,r);break;default:if(!u)for(c=1,u=new Array(l-1);l>c;c++)u[c-1]=arguments[c];h[f].fn.apply(h[f].context,u)}}return!0},i.prototype.on=function(t,e,r){var i=new n(e,r||this),s=o?o+t:t;return this._events||(this._events=o?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.once=function(t,e,r){var i=new n(e,r||this,!0),s=o?o+t:t;return this._events||(this._events=o?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.removeListener=function(t,e,r,n){var i=o?o+t:t;if(!this._events||!this._events[i])return this;var s=this._events[i],a=[];if(e)if(s.fn)(s.fn!==e||n&&!s.once||r&&s.context!==r)&&a.push(s);else for(var u=0,f=s.length;f>u;u++)(s[u].fn!==e||n&&!s[u].once||r&&s[u].context!==r)&&a.push(s[u]);return a.length?this._events[i]=1===a.length?a[0]:a:delete this._events[i],this},i.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[o?o+t:t]:this._events=o?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=o,"undefined"!=typeof e&&(e.exports=i)},{}],9:[function(t,e,r){(function(t){!function(t,r,n){r[t]=r[t]||n(),"undefined"!=typeof e&&e.exports?e.exports=r[t]:"function"==typeof define&&define.amd&&define(function(){return r[t]})}("Promise","undefined"!=typeof t?t:this,function(){"use strict";function t(t,e){c.add(t,e),l||(l=d(c.drain))}function e(t){var e,r=typeof t;return null==t||"object"!=r&&"function"!=r||(e=t.then),"function"==typeof e?e:!1}function r(){for(var t=0;t<this.chain.length;t++)n(this,1===this.state?this.chain[t].success:this.chain[t].failure,this.chain[t]);this.chain.length=0}function n(t,r,n){var i,o;try{r===!1?n.reject(t.msg):(i=r===!0?t.msg:r.call(void 0,t.msg),i===n.promise?n.reject(TypeError("Promise-chain cycle")):(o=e(i))?o.call(i,n.resolve,n.reject):n.resolve(i))}catch(s){n.reject(s)}}function i(n){var s,u=this;if(!u.triggered){u.triggered=!0,u.def&&(u=u.def);try{(s=e(n))?t(function(){var t=new a(u);try{s.call(n,function(){i.apply(t,arguments)},function(){o.apply(t,arguments)})}catch(e){o.call(t,e)}}):(u.msg=n,u.state=1,u.chain.length>0&&t(r,u))}catch(f){o.call(new a(u),f)}}}function o(e){var n=this;n.triggered||(n.triggered=!0,n.def&&(n=n.def),n.msg=e,n.state=2,n.chain.length>0&&t(r,n))}function s(t,e,r,n){for(var i=0;i<e.length;i++)!function(i){t.resolve(e[i]).then(function(t){r(i,t)},n)}(i)}function a(t){this.def=t,this.triggered=!1}function u(t){this.promise=t,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function f(e){if("function"!=typeof e)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var n=new u(this);this.then=function(e,i){var o={success:"function"==typeof e?e:!0,failure:"function"==typeof i?i:!1};return o.promise=new this.constructor(function(t,e){if("function"!=typeof t||"function"!=typeof e)throw TypeError("Not a function");o.resolve=t,o.reject=e}),n.chain.push(o),0!==n.state&&t(r,n),o.promise},this["catch"]=function(t){return this.then(void 0,t)};try{e.call(void 0,function(t){i.call(n,t)},function(t){o.call(n,t)})}catch(s){o.call(n,s)}}var h,l,c,p=Object.prototype.toString,d="undefined"!=typeof setImmediate?function(t){return setImmediate(t)}:setTimeout;try{Object.defineProperty({},"x",{}),h=function(t,e,r,n){return Object.defineProperty(t,e,{value:r,writable:!0,configurable:n!==!1})}}catch(m){h=function(t,e,r){return t[e]=r,t}}c=function(){function t(t,e){this.fn=t,this.self=e,this.next=void 0}var e,r,n;return{add:function(i,o){n=new t(i,o),r?r.next=n:e=n,r=n,n=void 0},drain:function(){var t=e;for(e=r=l=void 0;t;)t.fn.call(t.self),t=t.next}}}();var v=h({},"constructor",f,!1);return f.prototype=v,h(v,"__NPO__",0,!1),h(f,"resolve",function(t){var e=this;return t&&"object"==typeof t&&1===t.__NPO__?t:new e(function(e,r){if("function"!=typeof e||"function"!=typeof r)throw TypeError("Not a function");e(t)})}),h(f,"reject",function(t){return new this(function(e,r){if("function"!=typeof e||"function"!=typeof r)throw TypeError("Not a function");r(t)})}),h(f,"all",function(t){var e=this;return"[object Array]"!=p.call(t)?e.reject(TypeError("Not an array")):0===t.length?e.resolve([]):new e(function(r,n){if("function"!=typeof r||"function"!=typeof n)throw TypeError("Not a function");var i=t.length,o=Array(i),a=0;s(e,t,function(t,e){o[t]=e,++a===i&&r(o)},n)})}),h(f,"race",function(t){var e=this;return"[object Array]"!=p.call(t)?e.reject(TypeError("Not an array")):new e(function(r,n){if("function"!=typeof r||"function"!=typeof n)throw TypeError("Not a function");s(e,t,function(t,e){r(e)},n)})}),f})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]),!function(){var t={version:"1.0.0"},e=["ms","moz","webkit","o"],r=function(){for(var t=0,r=window.requestAnimationFrame,n=window.cancelAnimationFrame,i=e,o=0;o<i.length&&!r;++o)r=window[i[o]+"RequestAnimationFrame"],n=window[i[o]+"CancelAnimationFrame"]||window[i[o]+"CancelRequestAnimationFrame"];return r||(r=function(e,r){var n=(new Date).getTime(),i=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+i)},i);return t=n+i,o}),n||(n=function(t){clearTimeout(t)}),{requestAnimationFrame:function(t){return r.call(window,t)},cancelAnimationFrame:function(t){n.call(window,t)}}}(),n={canvas:function(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,r},hiDpiCanvas:function(t,e,r){r=r||this.pixelRatio;var n=document.createElement("canvas");return n.width=t*r,n.height=e*r,n.style.width=t+"px",n.style.height=e+"px",n.getContext("2d").setTransform(r,0,0,r,0,0),n},pixelRatio:function(){var t=1;console.log("dont forget you did this. set back to 1");for(var r=document.createElement("canvas").getContext("2d"),n=window.devicePixelRatio||1,i=r.backingStorePixelRatio,o=0;o<e.length&&!i;++o)i=r[e[o]+"BackingStorePixelRatio"];return i=i||1,n/i*t}(),mousePosition:function(t,e){var r=t.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top}},normalizedMousePosition:function(t,e){var r=t.getBoundingClientRect(),n=this.mousePosition(t,e);return{x:n.x/r.width,y:n.y/r.height}}},i=function(){function t(t,e){return t+": "+e}return{logError:function(e,r){var n=t(e,r);console.error(n)},throwError:function(e,r){var n=t(e,r);throw n}}}(),o={family:"sans-serif",size:12,leading:1.5,fill:"#000",style:"normal",weight:500,padding:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0},s={Properties:function(){return Object.keys(o)}(),ensurePropertyValues:function(t){for(var e=t||{},r=o,n=0;n<this.Properties.length;n++){var i=this.Properties[n];i in e&&(r[i]=e[i])}return r},stringifiedPadding:function(t){var e=t||this.ensurePropertyValues(),r=t.paddingTop||e.padding,n=e.paddingRight||e.padding,i=e.paddingBottom||e.padding,o=e.paddingLeft||e.padding;return r+"px "+n+"px "+i+"px "+o+"px"},sizeForText:function(t,e){var r,n=document.createElement("p"),e=this.ensurePropertyValues(e);return n.innerHTML=t,n.style.fontFamily=e.family,n.style.fontSize=e.size+"px",n.style.fontWeight=e.weight,n.style.fontStyle=e.style,n.style.padding=this.stringifiedPadding(e),n.style.lineHeight=e.leading,n.style.visibility="hidden",n.style.display="inline-block",document.body.appendChild(n),r={w:n.offsetWidth,h:n.offsetHeight},document.body.removeChild(n),r}},a={UniformTypes:["1f","2f","3f","4f"],validValueForUniformType:function(t,e){var r=!1,n=function(t,e,r){return!isNaN(t)};switch(t){case"1f":r=!isNaN(e)&&[e].every(n);break;case"2f":r=Array.isArray(e)&&2==e.length&&e.every(n);break;case"3f":r=Array.isArray(e)&&3==e.length&&e.every(n);break;case"4f":r=Array.isArray(e)&&4==e.length&&e.every(n)}return r},glslDataTypeForUniformType:function(t){var e;switch(t){case"1f":e="float";break;case"2f":e="vec2";break;case"3f":e="vec3";break;case"4f":e="vec4"}return e},fullSwizzleStringForUniformType:function(t){var e;switch(t){case"1f":e="x";break;case"2f":e="xy";break;case"3f":e="xyz";break;case"4f":e="xyzw"}return e}};t.Text=function(t,e){this.init(t,e)},t.Text.prototype=function(){return{constructor:t.Text,init:function(t,e){this.id=THREE.Math.generateUUID(),this.value=t,this.properties=s.ensurePropertyValues(e)}}}();var u=function(t){this.init.apply(this,arguments)};u.prototype=function(){function e(e,n){e instanceof Array||(e=[e]);for(var o=0;o<e.length;o++){var s=e[o];e instanceof t.Text&&i.throwError("blotter_Mapper","argument must be instance of Blotter.Text or array of objects that are instances of Blotter.Text"),n.call(this,s)}r.call(this)}function r(){var t=new GrowingPacker,e=[];for(var r in this.textsSizes){var n=this.textsSizes[r];n.referenceId=r,e.push(n)}t.fit(e.sort(o));for(var i=0;i<e.length;i++){var s=e[i];this.flipY&&(s.fit.y=t.root.h-(s.fit.y+s.h)),this.textsSizes[s.referenceId].fit=s.fit}this.width=t.root.w,this.height=t.root.h}function o(t,e){var r=t.w*t.h,n=e.w*e.h;return n-r}function a(t,e){var e=e||s.ensurePropertyValues().leading;return isNaN(e)?-1!==e.toString().indexOf("px")?e=parseInt(e):-1!==e.toString().indexOf("%")&&(e=parseInt(e)/100*t):e=t*e,e}return{constructor:u,init:function(t,e){var e=e||{};this.pixelRatio=e.pixelRatio||1,this.flipY=e.flipY||!1,this.texts=[],this.textsSizes={},this.width=0,this.height=0,this.addTexts(t)},addTexts:function(t){e.call(this,t,function(t){var e=this.textsSizes[t.id];if(-1==this.texts.indexOf(t)&&this.texts.push(t),!e){var r=s.sizeForText(t.value,t.properties);this.textsSizes[t.id]=r}})},removeTexts:function(t){e.call(this,t,function(t){var e=this.texts.indexOf(t);-1!=e&&this.texts.splice(e,1),delete this.textsSizes[t.id]})},sizeForText:function(t){return this.textsSizes[t.id]},toCanvas:function(){var t=n.hiDpiCanvas(this.width,this.height,this.pixelRatio),e=t.getContext("2d",{alpha:!1});e.textBaseline="middle";for(var r=0;r<this.texts.length;r++){var i=this.texts[r],o=this.textsSizes[i.id],s=a.call(this,i.properties.size,i.properties.leading)/2,u=o.fit.y+i.properties.paddingTop+s;e.font=i.properties.style+" "+i.properties.weight+" "+i.properties.size+"px "+i.properties.family,e.save(),e.translate(o.fit.x+i.properties.paddingLeft,u),this.flipY&&e.scale(1,-1),e.fillStyle=i.properties.fill,e.fillText(i.value,0,0),e.restore()}return t},getImage:function(){return this.toCanvas().toDataURL()}}}();var f=function(t,e){this.init(t,e)};f.prototype=function(){function t(t){var e=this,r=this.mapper.height*this.fidelityModifier,n=this.mapper.width*this.fidelityModifier,i=new Float32Array(r*n*4),o=n%1,s=1/this.mapper.texts.length/2;setTimeout(function(){for(var r=1;r<i.length/4;r++){for(var a=Math.ceil(r/(n-o)),u=r-(n-o)*(a-1),f=0,h=0,l=0,c=0;c<e.mapper.texts.length;c++){var p=e.mapper.texts[c],d=e.mapper.sizeForText(p),m=d.fit.y*e.fidelityModifier,v=d.fit.x*e.fidelityModifier,g=d.h*e.fidelityModifier,y=d.w*e.fidelityModifier;if(a>=m&&m+g>=a&&u>=v&&v+y>=u){f=c/e.mapper.texts.length+s,l=1;break}}var w=r-1;i[4*w+0]=f,i[4*w+1]=h,i[4*w+2]=h,i[4*w+3]=l}t(i)},1)}return{constructor:f,init:function(t,e){this.mapper=t,this.fidelityModifier=e||.5},build:function(e){var r=this;t.call(this,function(t){var n=new THREE.DataTexture(t,r.mapper.width*r.fidelityModifier,r.mapper.height*r.fidelityModifier,THREE.RGBAFormat,THREE.FloatType);n.flipY=!0,n.needsUpdate=!0,e(n)})}}}();var h=function(t,e){this.init(t,e)};h.prototype=function(){function t(t){var e=this,r=new Float32Array(4*this.mapper.texts.length);setTimeout(function(){for(var n=0;n<e.mapper.texts.length;n++){var i=e.mapper.texts[n],o=e.mapper.sizeForText(i);r[4*n]=o.fit.x*e.pixelRatio,r[4*n+1]=e.height*e.pixelRatio-(o.fit.y+o.h)*e.pixelRatio,r[4*n+2]=o.w*e.pixelRatio,r[4*n+3]=o.h*e.pixelRatio}t(r)},1)}return{constructor:h,init:function(t,e){this.mapper=t,this.pixelRatio=e||1,this.width=this.mapper.width,this.height=this.mapper.height},build:function(e){var r=this;t.call(this,function(t){var n=new THREE.DataTexture(t,r.mapper.texts.length,1,THREE.RGBAFormat,THREE.FloatType);n.needsUpdate=!0,e(n)})}}}();var l=function(t,e){this.init(t,e)};l.prototype=function(){function t(t,e){this.cache=[];for(var r=0;e>r;r++)this.cache.push(new Float32Array(t))}return{constructor:l,init:function(e,r){r=r||10,this.index=0,t.call(this,e,r)},next:function(){return this.current=this.cache[this.index],this.index++,this.index==this.cache.length&&(this.index=0),this.current}}}();var c=function(t,e,r){this.init(t,e,r)};c.prototype=function(){function t(t,e,r){
var n=document.createElement("canvas"),i=n.getContext("2d");this.cache=[];for(var o=0;r>o;o++)this.cache.push(i.createImageData(t,e));delete n}return{constructor:c,init:function(e,r,n){n=n||10,this.index=0,t.call(this,e,r,n)},next:function(){return this.current=this.cache[this.index],this.index++,this.index==this.cache.length&&(this.index=0),this.current}}}();var p=function(t,e){this.init(t,e)};p.prototype=function(){function t(t,e){this.cache=[];for(var r=0;e>r;r++)this.cache.push(new Uint8Array(t))}return{constructor:p,init:function(e,r){r=r||10,this.index=0,t.call(this,e,r)},next:function(){return this.current=this.cache[this.index],this.index++,this.index==this.cache.length&&(this.index=0),this.current}}}(),t.Material=function(t,e,r){this.init(t,e,r)},t.Material.prototype=function(){function e(t){Array.isArray(t)||(t=[t]);var e=new u(t,{pixelRatio:this.pixelRatio,flipY:!0});return this.width=e.width*this.pixelRatio,this.height=e.height*this.pixelRatio,e}function r(){var t=["varying vec2 _vTexCoord;","void main() {","  _vTexCoord = uv;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"];return t.join("\n")}function o(){var t,e=[],r=[],n=[];for(var i in this.userDefinedUniforms){var o=this,s=this.userDefinedUniforms[i];e.push("uniform sampler2D "+p.call(this,i)+";"),r.push(a.glslDataTypeForUniformType(s.type)+" "+i+";"),n.push(function(){var t=p.call(o,i),e=a.fullSwizzleStringForUniformType(s.type);return i+" = texture2D("+t+" , vec2(spriteIndex, 0.5))."+e+";"}())}return e=e.join("\n"),r=r.join("\n"),n=n.join("\n"),t=["precision highp float;","uniform sampler2D _uSampler;","uniform sampler2D _uSpriteIndicesTexture;","uniform sampler2D _uSpriteBoundsTexture;","uniform vec2 _uCanvasResolution;","varying vec2 _vTexCoord;","vec4 _spriteBounds;","vec2 uResolution;",e,r,"vec4 textTexture( vec2 coord ) {","   vec2 adjustedFragCoord = _spriteBounds.xy + vec2((_spriteBounds.z * coord.x), (_spriteBounds.w * coord.y));","   vec2 uv = adjustedFragCoord.xy / _uCanvasResolution;","   if (adjustedFragCoord.x < _spriteBounds.x ||","       adjustedFragCoord.x > _spriteBounds.x + _spriteBounds.z ||","       adjustedFragCoord.y < _spriteBounds.y ||","       adjustedFragCoord.y > _spriteBounds.y + _spriteBounds.w) {","     return vec4(0.0);","   }","   return texture2D(_uSampler, uv);","}","void mainImage( out vec4 mainImage, in vec2 fragCoord );",this.shaderSrc,"void main( void ) {","   vec4 spriteIndexData = texture2D(_uSpriteIndicesTexture, _vTexCoord);","   float spriteIndex = spriteIndexData.r;","   float spriteAlpha = spriteIndexData.a;","   _spriteBounds = texture2D(_uSpriteBoundsTexture, vec2(spriteIndex, 0.5));","   uResolution = _spriteBounds.zw;",n,"   vec2 fragCoord = gl_FragCoord.xy - _spriteBounds.xy;","   vec4 outColor;","   mainImage(outColor, fragCoord);","   outColor.a = outColor.a * spriteAlpha;","   gl_FragColor = outColor;//texture2D(_uSampler, _vTexCoord);//vec4(1.0, 0.6705882353, 0.2509803922, 0.7);//outColor;//vec4(1.0, 1.0, 0.5, 1.0);//","}"],t.join("\n")}function s(){for(var t in this.userDefinedUniforms)if(this.userDefinedUniforms.hasOwnProperty(t))for(var e=0;e<this.mapper.texts.length;e++){var r=this.mapper.texts[e],n=this.userDefinedUniforms[t];if(-1==a.UniformTypes.indexOf(n.type))return void i.logError("Blotter.Material","user defined uniforms must be one of type: "+a.UniformTypes.join(", "));if(!a.validValueForUniformType(n.type,n.value))return void i.logError("Blotter.Material","user defined uniform value for "+t+" is incorrect for type: "+n.type);this.textsUniformsValues[r.id]=this.textsUniformsValues[r.id]||{},this.textsUniformsValues[r.id][t]=JSON.parse(JSON.stringify(n))}}function c(t){var e,r=this,n=new THREE.TextureLoader,i=d.call(this),o=new f(this.mapper,this.fidelity),s=new h(this.mapper,this.pixelRatio);n.load(this.mapper.getImage(),function(n){o.build(function(o){s.build(function(s){n.generateMipmaps=!1,n.minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.needsUpdate=!0,e={_uSampler:{type:"t",value:n},_uCanvasResolution:{type:"2f",value:[r.width,r.height]},_uSpriteIndicesTexture:{type:"t",value:o},_uSpriteBoundsTexture:{type:"t",value:s}};for(var a in i)e[a]=i[a];t(e)})})})}function p(t){return"_"+t+"Texture"}function d(){var t={};for(var e in this.userDefinedUniforms)t[p.call(this,e)]={value:m.call(this,e),type:"t"};return t}function m(t){var e=this.userDefinedUniforms[t],r=this.float32ArrayCache.next();e||i.logError("Blotter.Composer","cannot find uniformName for _uniformTextureForUniformName");for(var n=0;n<this.mapper.texts.length;n++){var o=this.mapper.texts[n],s=this.textsUniformsValues[o.id];if(s){var a=s[t];"1f"==a.type?(r[4*n]=a.value,r[4*n+1]=0,r[4*n+2]=0,r[4*n+3]=0):"2f"==a.type?(r[4*n]=a.value[0],r[4*n+1]=a.value[1],r[4*n+2]=0,r[4*n+3]=0):"3f"==a.type?(r[4*n]=a.value[0],r[4*n+1]=a.value[1],r[4*n+2]=a.value[2],r[4*n+3]=0):"4f"==a.type?(r[4*n]=a.value[0],r[4*n+1]=a.value[1],r[4*n+2]=a.value[2],r[4*n+3]=a.value[3]):(r[4*n]=0,r[4*n+1]=0,r[4*n+2]=0,r[4*n+3]=0)}else r[4*n]=0,r[4*n+1]=0,r[4*n+2]=0,r[4*n+3]=0}var u=new THREE.DataTexture(r,this.mapper.texts.length,1,THREE.RGBAFormat,THREE.FloatType);return u.needsUpdate=!0,u}return{constructor:t.Material,init:function(t,r,i){i=i||{},this.pixelRatio=i.pixelRatio||n.pixelRatio,this.mapper=e.call(this,t),this.float32ArrayCache=new l(4*this.mapper.texts.length),this.shaderSrc=r,this.userDefinedUniforms=i.uniforms||{},this.fidelity=.5,this.textsUniformsValues={},s.call(this)},load:function(t){var e=this;c.call(this,function(n){e.threeMaterial=new THREE.ShaderMaterial({vertexShader:r.call(e),fragmentShader:o.call(e),uniforms:n}),e.threeMaterial.depthTest=!1,e.threeMaterial.depthWrite=!1,t()})},hasText:function(e){return e instanceof t.Text||i.logError("Blotter.Material","argument must be instanceof Blotter.Text"),!!this.textsUniformsValues[e.id]},updateUniformValueForText:function(t,e,r){var n=this.textsUniformsValues[t.id];return n?n[e]?a.validValueForUniformType(n[e].type,r)?(n[e].value=r,this.threeMaterial.uniforms[p.call(self,e)]={type:"t",value:m.call(this,e)},void(this.threeMaterial.needsUpdate=!0)):void i.logError("Blotter.Material","user defined uniform value for "+e+" is incorrect for type: "+this.userDefinedUniforms[e].type):void i.logError("Blotter.Material","cannot find uniformName for updateUniformsForText"):void i.logError("Blotter.Material","cannot find text for updateUniformsForText")}}}();var d=function(t,e,r){this.init(t,e,r)};d.prototype=function(){function t(){var t=EventEmitter.prototype;for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}function e(){for(var t=this,e=["mousedown","mouseup","mousemove","mouseenter","mouseleave"],r=0;r<e.length;r++){var i=e[r];!function(t,e){t.domElement.addEventListener(e,function(r){var i=n.normalizedMousePosition(t.domElement,r);t.emit(e,i)},!1)}(t,i)}}function r(){e.call(this)}function i(){this.domElement&&(this.context.clearRect(0,0,this.size.w*this.pixelRatio,this.size.h*this.pixelRatio),this.context.putImageData(this.renderer.imageData,this._xOffset,this._yOffset),this.emit("update",this.frameCount))}return{constructor:d,init:function(e,r,n){n=n||{},"undefined"==typeof n.autostart&&(n.autostart=!0),this.text=e,this.renderer=r,this.size=this.renderer.blotterMaterial.mapper.sizeForText(e),this.pixelRatio=this.renderer.blotterMaterial.pixelRatio,this._xOffset=-1*~~(this.size.fit.x*this.pixelRatio),this._yOffset=-1*~~((this.renderer.blotterMaterial.mapper.height-(this.size.fit.y+this.size.h))*this.pixelRatio),this.playing=n.autostart,this.timeDelta=0,this.lastDrawTime,this.frameCount=0,this.domElement,this.context,t.call(this)},play:function(){this.playing=!0},pause:function(){this.playing=!1},update:function(){var t=Date.now();this.frameCount+=1,this.timeDelta=(t-(this.lastDrawTime||t))/1e3,this.lastDrawTime=t,i.call(this)},appendTo:function(t){this.domElement&&(this.domElement.remove(),this.context=null),this.domElement=n.hiDpiCanvas(this.size.w,this.size.h),this.context=this.domElement.getContext("2d"),t.appendChild(this.domElement),r.call(this)}}}(),t.Renderer=function(t){this.init(t)},t.Renderer.prototype=function(){function e(){var t=this;this.backBufferRenderer.render(this.backBufferScene,this.backBufferCamera,this.backBufferTexture),this.backBufferRenderer.readRenderTargetPixels(this.backBufferTexture,0,0,this.backBufferTexture.width,this.backBufferTexture.height,this.frameBuffer);for(var n in this.textScopes)this.textScopes[n].playing&&this.textScopes[n].update();this.currentAnimationLoop=r.requestAnimationFrame(function(){e.call(t)})}return{constructor:t.Renderer,init:function(t,e){e=e||{},"undefined"==typeof e.autostart&&(e.autostart=!0),Detector.webgl||i.throwError("Blotter.Renderer","device does not support webgl"),t.threeMaterial||i.throwError("Blotter.Renderer","material does not expose property threeMaterial. Did you forget to call #load on your Blotter.Material object before instantiating Blotter.Renderer?"),this.blotterMaterial=t,this.textScopes={};var r=this.blotterMaterial.width,n=this.blotterMaterial.height;this.backBufferScene=new THREE.Scene,this.backBufferTexture=new THREE.WebGLRenderTarget(r,n,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType}),this.backBufferTexture.texture.generateMipmaps=!1,this.backBufferTexture.width=r,this.backBufferTexture.height=n,this.backBufferMaterial=this.blotterMaterial.threeMaterial,this.backBufferPlane=new THREE.PlaneGeometry(r,n),this.backBufferObject=new THREE.Mesh(this.backBufferPlane,this.backBufferMaterial),this.backBufferScene.add(this.backBufferObject),this.backBufferRenderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,premultipliedAlpha:!1}),this.backBufferRenderer.setSize(r,n),this.backBufferCamera=new THREE.OrthographicCamera(r/-2,r/2,n/2,n/-2,0,100),this.sharedBuffer=new ArrayBuffer(r*n*4),this.frameBuffer=new Uint8Array(this.sharedBuffer),this.imageDataBuffer=new Uint8ClampedArray(this.sharedBuffer),this.imageData=new ImageData(this.imageDataBuffer,r,n),e.autostart&&this.start()},start:function(){this.currentAnimationLoop||e.call(this)},stop:function(){this.currentAnimationLoop&&(r.cancelAnimationFrame(this.currentAnimationLoop),this.currentAnimationLoop=void 0)},teardown:function(){this.stop(),this.renderer=null,this.domElement.remove()},forText:function(e,r){if(!(e instanceof t.Text))return void i.logError("Blotter.Renderer","argument must be instanceof Blotter.Text");if(!this.blotterMaterial.hasText(e))return void i.logError("Blotter.Renderer","Blotter.Text object not found in material");if(r=r||{},"undefined"==typeof r.autostart&&(r.autostart=!0),!this.textScopes[e.id]){var n=new d(e,this,r);this.textScopes[e.id]=n}return this.textScopes[e.id]}}}(),this.Blotter=t}();