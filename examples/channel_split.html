<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <style type="text/css">
      body {
        background: #202020;
        padding: 20px;
        font-family: serif;
        font-size: 64px;
        font-weight: 100;
        line-height: 1.5;
      }

      canvas {
        padding: 0;
        margin: 0;
        vertical-align: top;
      }
    </style>

    <script type="text/javascript" src="./third_party/jquery.min.js"></script>
    <script type="text/javascript" src="./third_party/dat.gui.js"></script>
    <script type="text/javascript" src="../build/blotter.js"></script>
    <script type="text/javascript" src="../build/filters/channelSplitMaterial.js"></script>
  </head>
  <body>
    <div id="filter-target"></div>
    <script>

      function angleBetweenPointsInDegrees(x1, y1, x2, y2) {
        var angle = Math.atan2(y2 - y1, x2 - x1) * 180.0 / Math.PI;

        angle = 180 + angle; // Im not entirely sure why this is necessarh currently. Try logging without it.

        return angle;
      }

      function distanceBetweenPoints(x1, y1, x2, y2) {
        var a = x1 - x2;
        var b = y1 - y2;

        return Math.sqrt((a * a) + (b * b));
      }

      $(document).ready(function() {

        var styleProperties = {
          family: "serif",
          fill: "#FFFFFF",
          size: 268,
          weight: 800,
          leading: 1.02,
          paddingTop: 70,
          paddingBottom: 70,
          paddingLeft: 70,
          paddingRight: 70
        };

        var text = new Blotter.Text("A24", styleProperties);

        var material = new Blotter.ChannelSplitMaterial();
        material.uniforms.uBlendColor.value = [0.2, 0.2, 0.2, 1.0];

        var blotter = new Blotter(material, {
          texts : text
        });

        var myScope = blotter.forText(text);

        blotter.on("ready", function () {
          myScope.appendTo(document.getElementById("filter-target"));
        });

        myScope.on("mousemove", function (mousePosition) {
          var angle = angleBetweenPointsInDegrees(0.5, 0.5, mousePosition.x, mousePosition.y);
          var blur = Math.min(0.3, distanceBetweenPoints(0.5, 0.5, mousePosition.x, mousePosition.y));

          myScope.material.uniforms.uRotation.value = angle;
          myScope.material.uniforms.uOffset.value = blur;
        });

        var controls = {
          uOffset : material.uniforms.uOffset.value,
          uRotation : material.uniforms.uRotation.value,
          uApplyBlur : !!material.uniforms.uApplyBlur.value,
          uAnimateNoise : !!material.uniforms.uAnimateNoise.value
        };

        var gui = new dat.GUI();

        gui.add(controls, 'uOffset', 0.0, 1.0).onChange(function (offset) {
          material.uniforms.uOffset.value = offset;
        }).step(0.01);
        gui.add(controls, 'uRotation', 0.0, 360.0).onChange(function (angle) {
          material.uniforms.uRotation.value = angle;
        });
        gui.add(controls, "uApplyBlur").onChange(function (bool) {
          material.uniforms.uApplyBlur.value = bool ? 1.0 : 0.0;
        });
        gui.add(controls, "uAnimateNoise").onChange(function (bool) {
          material.uniforms.uAnimateNoise.value = bool ? 1.0 : 0.0;
        });
      });
    </script>
  </body>
</html>
