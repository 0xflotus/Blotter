<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-beta1/jquery.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r74/three.js"></script>
    <script type="text/javascript" src="../blotter.js"></script>
  </head>
  <body>
    <div class="canvas-region"></div>

    <canvas class="mouse-position-canvas" width="200" height="200"></canvas>

    <script>
      $(document).ready(function() {


        /**
        *   SET UP BLOTTER.
        *   ------------------------------------------------------
        */

        var texts = ['To', 'communicate', 'Mars', 'converse', 'spirits', 'report', 'the', 'behaviour', 'of', 'sea', 'monster', 'Describe', 'horoscope', 'haruspicate', 'or', 'scry', 'Observe', 'disease', 'in', 'signatures', 'evoke', 'Biography', 'from', 'wrinkles', 'palm', 'And', 'tragedy', 'fingers', 'release', 'omens', 'By', 'sortilege', 'tea', 'leaves', 'riddle', 'inevitable', 'With', 'playing', 'cards', 'fiddle', 'pentagrams', 'Or', 'barbituric', 'acids', 'dissect', 'Sed', 'tincidunt', 'tempor', 'consectetur.', 'Cras', 'imperdiet', 'suscipit', 'massa,', 'ut', 'malesuada', 'enim', 'sollicitudin', 'in.', 'Nullam', 'cursus,', 'lorem', 'vitae', 'cursus', 'gravida,', 'erat'];

        var styleProperties = {
          family: "Charcoal, sans-serif",
          size: 12,
          paddingTop: 12,
          paddingRight: 17,
          paddingBottom: 12,
          paddingLeft: 17,
          leading: 1.5,
          fill: "#0d0f17"
        };

        var blotterTexts = texts.map(function(text) { return new Blotter.Text(text, styleProperties); });

        var mapper = new Blotter.Mapper(blotterTexts);

        var material = new Blotter.MappedMaterial(mapper, false, {
          uniforms : {
            uCenterPoint : { type : "2f", value : [0.5, 0.5] },
            uLenseWeight : { type : "1f", value : 0.9 }
          }
        });

        material.load(function () {
          var renderer = new Blotter.MaterialRenderer(material);
          $(".canvas-region").html(renderer.domElement);
          renderer.start();
        })





        /**
        *   STUFF FOR MOUSE POSITION FOR THIS EXAMPLE.
        *   ------------------------------------------------------
        */

        var mousePositionCanvas = document.getElementsByClassName("mouse-position-canvas")[0],
            ctx = mousePositionCanvas.getContext("2d");

        mousePositionCanvas.style.border = "1px solid black";

        function getMousePos(canvas, e) {
          var rect = canvas.getBoundingClientRect();
          return {
            x: e.clientX - rect.left,
            y: e.clientY - rect.top
          };
        }

        mousePositionCanvas.addEventListener('mousemove', function(e) {
          var mousePos = getMousePos(mousePositionCanvas, e),
              nX = mousePos.x / mousePositionCanvas.width,
              nY = 1.0 - (mousePos.y / mousePositionCanvas.height);

          material.updateUniformValueForText(blotterTexts[35], "uCenterPoint", [nX, nY]);
        }, false);
      });
    </script>
  </body>
</html>
